# Column Configuration
# Combines display names and type settings for automatic column formatting
#
# Structure:
#   columns:       Global column patterns (apply to all tables)
#   tables:        Table-specific overrides
#
# Column types (determines filtering behavior):
#   text:        Plain text, text operators (=, !=, LIKE)
#   numeric:     Formatted number, comparison operators (=, !=, >, <, >=, <=)
#   currency:    Number with currency symbol, comparison operators
#   date:        Date/datetime formatting, comparison operators
#   categorical: Plain text (default), set operators (IN, NOT IN)
#   link:        Clickable link to external URL, text operators
#   address:     Blockchain address with truncation, text operators
#
# Optional: renderAs (overrides visual rendering while preserving type for filtering)
#   - "chip": Renders as Badge (use with type: categorical for chips with IN/NOT IN filtering)
#   - Any column type: Renders using that type's visual style
#
# Example: type: categorical + renderAs: chip
#   â†’ Keeps IN/NOT IN filter operators, renders as Badge with optional variants

columns:
  # Currency columns with custom display names
  DOT_latest:
    displayName: "DOT Value"
    type: currency
    currency: DOT
    decimals: 0

  DOT_proposal_time:
    displayName: "DOT (at Proposal)"
    type: currency
    currency: DOT
    decimals: 0

  USD_latest:
    displayName: "USD Value"
    type: currency
    currency: USD
    decimals: 0

  USD_proposal_time:
    displayName: "USD (at Proposal)"
    type: currency
    currency: USD
    decimals: 0

  # Date columns with custom display names
  latest_status_change:
    displayName: "Date"
    type: date
    format: date

  validFrom:
    displayName: "Valid From"
    type: date
    format: date

  expireAt:
    displayName: "Expires"
    type: date
    format: date

  # Computed time columns
  year:
    displayName: "Year"
    type: text

  year_month:
    displayName: "Month"
    type: text

  year_quarter:
    displayName: "Quarter"
    type: text

  # Reference/link columns
  referendumIndex:
    displayName: "Ref #"
    type: link
    urlTemplate: "https://polkadot.subsquare.io/referenda/{value}"

  parentBountyId:
    displayName: "Parent Bounty"
    type: link
    urlTemplate: "https://polkadot.subsquare.io/treasury/bounties/{value}"

  # Count/number columns
  registeredCount:
    displayName: "Registered"
    type: numeric
    decimals: 0

  registeredPaidCount:
    displayName: "Paid"
    type: numeric
    decimals: 0

  rank:
    displayName: "Rank"
    type: numeric
    decimals: 0

  cycle:
    displayName: "Cycle"
    type: numeric
    decimals: 0

  # Tally columns with custom display names
  tally_ayes:
    displayName: "Ayes"
    type: numeric
    decimals: 0
    color: green

  tally_nays:
    displayName: "Nays"
    type: numeric
    decimals: 0
    color: red

  # Days columns
  days_until_expiry:
    displayName: "Days Until Expiry"
    type: numeric
    decimals: 0

  days_until_valid:
    displayName: "Days Until Valid"
    type: numeric
    decimals: 0

  days_since_expiry:
    displayName: "Days Since Expiry"
    type: numeric
    decimals: 0

# Table-specific overrides
tables:
  all_spending:
    id:
      displayName: "ID"
      type: text

    title:
      displayName: "Description"
      type: link
      urlField: url

    type:
      displayName: "Spending Type"
      type: categorical
      renderAs: chip
      variants:
        Direct Spend: default
        Bounty Child: secondary
        Claim: outline
        default: outline

  referenda:
    id:
      displayName: "Ref #"
      type: link
      urlTemplate: "https://polkadot.subsquare.io/referenda/{value}"

    title:
      type: link
      urlField: url

    track:
      displayName: "Track"
      type: categorical
      renderAs: chip
      variants:
        default: outline

  treasury:
    id:
      displayName: "Spend #"
      type: link
      urlTemplate: "https://polkadot.subsquare.io/treasury/spends/{value}"

    title:
      type: link
      urlField: url

  child-bounties:
    identifier:
      displayName: "ID"
      type: text

    title:
      type: link
      urlField: url

  fellowship:
    id:
      displayName: "Ref #"
      type: link
      urlTemplate: "https://collectives.subsquare.io/fellowship/referenda/{value}"

    title:
      type: link
      urlField: url

  outstanding_claims:
    id:
      displayName: "Spend #"
      type: link
      urlTemplate: "https://polkadot.subsquare.io/treasury/spends/{value}"

  expired_claims:
    id:
      displayName: "Spend #"
      type: link
      urlTemplate: "https://polkadot.subsquare.io/treasury/spends/{value}"

  DataErrors:
    table_name:
      displayName: "Table"
      type: categorical
      renderAs: chip
    record_id:
      displayName: "Record ID"
      type: text
    error_type:
      displayName: "Error Type"
      type: categorical
      renderAs: chip
      variants:
        missing_value: destructive
        historical_null: warning
        default: outline
    error_message:
      displayName: "Error Message"
      type: text
    timestamp:
      displayName: "Timestamp"
      type: date
      format: datetime
    metadata:
      displayName: "Metadata"
      type: text_long
      modalTitle: "Error Metadata"
      isJson: true
    raw_data:
      displayName: "Raw Data"
      type: text_long
      modalTitle: "Raw API Data"
      isJson: true

# Pattern-based auto-detection (fallback when no explicit config exists)
# Patterns are evaluated in order, first match wins
# Pattern types: exact, prefix, suffix, substring
# Options: caseInsensitive (default: false)
patterns:
  # Currency patterns - substring matching to support table-prefixed columns (e.g., "all_spending.DOT_latest")
  - match: substring
    pattern: "DOT_"
    config:
      type: currency
      currency: DOT
      decimals: 0

  - match: substring
    pattern: "USD_"
    config:
      type: currency
      currency: USD
      decimals: 0

  - match: substring
    pattern: "USDC_"
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: substring
    pattern: "USDT_"
    config:
      type: currency
      currency: USDT
      decimals: 0

  # Tally patterns - suffix matching (case-insensitive)
  - match: suffix
    pattern: "_ayes"
    caseInsensitive: true
    config:
      type: numeric
      color: green
      decimals: 0

  - match: suffix
    pattern: "_nays"
    caseInsensitive: true
    config:
      type: numeric
      color: red
      decimals: 0

  # Date patterns - substring matching (case-insensitive)
  - match: substring
    pattern: "_time"
    caseInsensitive: true
    config:
      type: date
      format: date

  - match: substring
    pattern: "_date"
    caseInsensitive: true
    config:
      type: date
      format: date

  # Special date field - exact matching
  - match: exact
    pattern: "createdat"
    caseInsensitive: true
    config:
      type: date
      format: date

  # Status patterns - exact and suffix matching
  - match: exact
    pattern: "status"
    caseInsensitive: true
    config:
      type: categorical
      renderAs: chip
      variants:
        Executed: success
        Approved: success
        Paid: success
        Rejected: destructive
        Cancelled: destructive
        Expired: destructive
        default: outline

  - match: suffix
    pattern: "_status"
    caseInsensitive: true
    config:
      type: categorical
      renderAs: chip
      variants:
        Executed: success
        Approved: success
        Paid: success
        Rejected: destructive
        Cancelled: destructive
        Expired: destructive
        default: outline

  # Categorical patterns - columns with finite value sets
  - match: exact
    pattern: "track"
    caseInsensitive: true
    config:
      type: categorical
      renderAs: chip
      variants:
        default: outline

  - match: exact
    pattern: "type"
    caseInsensitive: true
    config:
      type: categorical
      renderAs: chip
      variants:
        default: outline

  - match: exact
    pattern: "category"
    caseInsensitive: true
    config:
      type: categorical    # keeps IN/NOT IN filtering, renders as text by default

  - match: exact
    pattern: "subcategory"
    caseInsensitive: true
    config:
      type: categorical    # keeps IN/NOT IN filtering, renders as text by default

  - match: exact
    pattern: "parentBountyName"
    config:
      type: categorical
      renderAs: chip
      variants:
        default: outline

  # Address patterns - exact matching
  - match: exact
    pattern: "beneficiary"
    caseInsensitive: true
    config:
      type: address
      truncate: true

  - match: exact
    pattern: "address"
    caseInsensitive: true
    config:
      type: address
      truncate: true

  - match: exact
    pattern: "who"
    caseInsensitive: true
    config:
      type: address
      truncate: true

  - match: suffix
    pattern: "_address"
    caseInsensitive: true
    config:
      type: address
      truncate: true

  # Non-standard currency columns (exact matches for tables without prefix)
  - match: exact
    pattern: "DOT"
    caseInsensitive: true
    config:
      type: currency
      currency: DOT
      decimals: 0

  - match: exact
    pattern: "USD"
    caseInsensitive: true
    config:
      type: currency
      currency: USD
      decimals: 0

  - match: exact
    pattern: "USDC"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "USDT"
    caseInsensitive: true
    config:
      type: currency
      currency: USDT
      decimals: 0

  - match: exact
    pattern: "registered_amount_dot"
    caseInsensitive: true
    config:
      type: currency
      currency: DOT
      decimals: 0

  - match: exact
    pattern: "attempt_amount_dot"
    caseInsensitive: true
    config:
      type: currency
      currency: DOT
      decimals: 0

  # Non-standard USDC columns (exact matches for tables without USDC_ prefix)
  - match: exact
    pattern: "budget_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "registered_paid_amount_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "total_registrations_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "unregistered_paid_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "registered_amount_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "attempt_amount_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "amount_usdc"
    caseInsensitive: true
    config:
      displayName: "Paid USDC"
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "salary_usdc"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: exact
    pattern: "amount_dot"
    caseInsensitive: true
    config:
      displayName: "Paid DOT Equivalent"
      type: currency
      currency: DOT
      decimals: 2

  # Aggregate patterns - detect currency from aliases containing currency names
  # These are fallback patterns for columns like "SUM USD", "Total DOT", etc.
  # IMPORTANT: These should remain at the end to avoid matching non-currency columns
  - match: substring
    pattern: " USD"
    config:
      type: currency
      currency: USD
      decimals: 0

  - match: substring
    pattern: "_USD"
    caseInsensitive: true
    config:
      type: currency
      currency: USD
      decimals: 0

  - match: substring
    pattern: " DOT"
    config:
      type: currency
      currency: DOT
      decimals: 0

  - match: substring
    pattern: "_DOT"
    caseInsensitive: true
    config:
      type: currency
      currency: DOT
      decimals: 0

  - match: substring
    pattern: " USDC"
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: substring
    pattern: "_USDC"
    caseInsensitive: true
    config:
      type: currency
      currency: USDC
      decimals: 0

  - match: substring
    pattern: " USDT"
    config:
      type: currency
      currency: USDT
      decimals: 0

  - match: substring
    pattern: "_USDT"
    caseInsensitive: true
    config:
      type: currency
      currency: USDT
      decimals: 0
